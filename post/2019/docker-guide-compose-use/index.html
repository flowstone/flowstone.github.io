<!doctype html><html lang=zh-cn data-theme-mode=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Docker入门-docker compose的使用 | 薛尧笔记
</title><meta name=description content="平凡的程序员"><script>window.siteConfig=JSON.parse('{"anchor_icon":null,"clipboard":{"copyright":{"content":"本文版权：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！","count":50,"enable":true},"fail":"复制失败 (ﾟ⊿ﾟ)ﾂ","success":"复制成功(*^▽^*)"},"code_block":{"expand":true},"icon_font":false,"outdate":{"daysago":180,"enable":false,"message":"本文最后更新于 {time}，请注意文中内容可能已经发生变化。"}}')</script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap" media=print onload='this.media="all"'><link rel=stylesheet href=https://npm.webcache.cn/@fortawesome/fontawesome-free@6.5.1/css/regular.min.css><link rel=stylesheet href=https://npm.webcache.cn/@fortawesome/fontawesome-free@6.5.1/css/solid.min.css><link rel=preload as=style href=https://npm.webcache.cn/@fortawesome/fontawesome-free@6.5.1/css/brands.min.css onload='this.onload=null,this.rel="stylesheet"'><link rel=preload as=style href=https://npm.webcache.cn/@fortawesome/fontawesome-free@6.5.1/css/v5-font-face.min.css onload='this.onload=null,this.rel="stylesheet"'><link rel=preload as=style href=https://npm.webcache.cn/@fortawesome/fontawesome-free@6.5.1/css/v4-font-face.min.css onload='this.onload=null,this.rel="stylesheet"'><link rel=stylesheet href=../../../css/loader.min.2ad0e9bbffb534e893c0ecefc44787a277cf851387e8ad9dccfbc3a5f0886dbe.css><meta property="og:type" content="website"><meta property="og:title" content="Docker入门-docker compose的使用 | 薛尧笔记"><meta property="og:description" content="平凡的程序员"><meta property="og:url" content="https://xueyao.netlify.app/post/2019/docker-guide-compose-use/"><meta property="og:site_name" content="薛尧笔记"><meta property="og:image" content="/"><meta property="article:author" content="薛尧笔记"><meta property="article:published_time" content="2019-08-19T12:33:56+00:00"><meta property="article:modified_time" content="2019-08-19T12:33:56+00:00"><meta name=twitter:card content="summary"><meta name=twitter:image content="/"><link rel="shortcut icon" href=../../../favicon.ico><link rel=stylesheet href=../../../css/main.min.143179f54c62ebce7836fb39e5eda715061f26ae332b2159e1e044f794926605.css><link rel=preload as=style href=https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css onload='this.onload=null,this.rel="stylesheet"'><link rel=preload as=style href=https://npm.webcache.cn/katex@0.16.9/dist/katex.min.css onload='this.onload=null,this.rel="stylesheet"'><link rel=stylesheet href=https://npm.webcache.cn/@waline/client@2.15.8/dist/waline.css><script src=https://npm.webcache.cn/pace-js@1.2.4/pace.min.js integrity=sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8 crossorigin=anonymous></script><link rel=stylesheet href=https://npm.webcache.cn/@reimujs/aos@0.1.0/dist/aos.css><link rel=stylesheet href=https://npm.webcache.cn/aplayer@1.10.1/dist/APlayer.min.css></head><body><div id=loader><div class="loading-left-bg loading-bg"></div><div class="loading-right-bg loading-bg"></div><div class=spinner-box><div class=loading-taichi><img src=../../../images/logo.png alt=loading></div><div class=loading-word>喝杯水，放松一下心情...</div></div></div></div><script>var time=null,startLoading=()=>{time=Date.now(),document.getElementById("loader").classList.remove("loading")},endLoading=()=>{time?Date.now()-time>500?(time=null,document.body.style.overflow="auto",document.getElementById("loader").classList.add("loading")):(setTimeout(endLoading,500-(Date.now()-time)),time=null):(document.body.style.overflow="auto",document.getElementById("loader").classList.add("loading"))};window.addEventListener("DOMContentLoaded",endLoading),document.getElementById("loader").addEventListener("click",endLoading)</script><div id=copy-tooltip style="pointer-events:none;opacity:0;transition:all .2s ease;position:fixed;top:50%;left:50%;z-index:999;transform:translate(-50%,-50%);color:#fff;background:rgba(0,0,0,.5);padding:10px 15px;border-radius:10px"></div><div id=container><div id=wrap><div id=header-nav><nav id=main-nav><span class=main-nav-link-wrap><div class='main-nav-icon icon'>&#xf015;</div><a class=main-nav-link href=../../../>首页</a>
</span><span class=main-nav-link-wrap><div class='main-nav-icon icon'>&#xf187;</div><a class=main-nav-link href=../../../archives>归档</a>
</span><span class=main-nav-link-wrap><div class='main-nav-icon icon'>&#xf129;</div><a class=main-nav-link href=../../../about>关于</a>
</span><span class=main-nav-link-wrap><div class='main-nav-icon icon'>&#xf004;</div><a class=main-nav-link href=../../../friend>友链</a>
</span><a id=main-nav-toggle class=nav-icon></a></nav><nav id=sub-nav></nav></div><header id=header><picture><source media="(max-width: 479px)" srcset=../../../images/banner-600w.webp><source media="(max-width: 799px)" srcset=../../../images/banner-800w.webp><source media="(min-width: 800px)" srcset=../../../images/banner.webp><img fetchpriority=high src=../../../images/banner.webp alt="Docker入门-docker compose的使用">
</picture><img src alt="Docker入门-docker compose的使用" style=visibility:hidden><div id=header-outer><div id=header-title><a href=../../../ id=logo><h1 data-aos=slide-up>Docker入门-docker compose的使用</h1></a><h2 id=subtitle-wrap data-aos=slide-down></h2></div></div></header><div id=content class=sidebar-left><aside id=sidebar><div class="sidebar-wrapper wrap-sticky"><div class=sidebar-wrap data-aos=fade-up><div class=sidebar-toc-sidebar><div class=sidebar-toc><h3 class=toc-title>文章目录</h3><div class="sidebar-toc-wrapper toc-div-class"><nav id=TableOfContents><ul><li><a href=#compose简介>Compose简介</a></li><li><a href=#安装和卸载>安装和卸载</a><ul><li><a href=#linux安装docker-compose>Linux安装docker-compose</a></li></ul></li><li><a href=#使用>使用</a><ul><li><a href=#compose构建dubbo-admin服务>Compose构建dubbo-admin服务</a></li></ul></li><li><a href=#compose命令说明>Compose命令说明</a><ul><li><a href=#命令对象与格式>命令对象与格式</a></li></ul></li><li><a href=#compose模板文件>Compose模板文件</a></li></ul></nav></div></div></div><div class="sidebar-common-sidebar hidden"><div class=sidebar-author><img data-src=../../../avatar/avatar.png data-sizes=auto alt=薛尧笔记 class=lazyload><div class=sidebar-author-name>薛尧笔记</div><div class=sidebar-description>平凡的程序员</div></div><div class=sidebar-state><div class=sidebar-state-article><div>文章</div><div class=sidebar-state-number>83</div></div><div class=sidebar-state-category><div>分类</div><div class=sidebar-state-number>17</div></div><div class=sidebar-state-tag><div>标签</div><div class=sidebar-state-number>12</div></div></div><div class=sidebar-social><div class="icon-github sidebar-social-icon"><a href=https://github.com/flowstone itemprop=url target=_blank aria-label=github rel="noopener external nofollow noreferrer"></a></div></div><div class=sidebar-menu><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=../../../ aria-label=首页></a><div class='sidebar-menu-icon icon'>&#xf015;</div><div class=sidebar-menu-link>首页</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=../../../archives aria-label=归档></a><div class='sidebar-menu-icon icon'>&#xf187;</div><div class=sidebar-menu-link>归档</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=../../../about aria-label=关于></a><div class='sidebar-menu-icon icon'>&#xf129;</div><div class=sidebar-menu-link>关于</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=../../../friend aria-label=友链></a><div class='sidebar-menu-icon icon'>&#xf004;</div><div class=sidebar-menu-link>友链</div></div></div></div><div class=sidebar-btn-wrapper style=position:static><div class="sidebar-toc-btn current"></div><div class=sidebar-common-btn></div></div></div></div><div class=sidebar-widget></div></aside><section id=main><article class="h-entry article" itemprop=blogPost itemscope itemtype=https://schema.org/BlogPosting><div class=article-inner data-aos=fade-up><div class=article-meta><div class=article-date><a href=https://xueyao.netlify.app/post/2019/docker-guide-compose-use/ class=article-date-link data-aos=zoom-in><time datetime="2019-08-19 12:33:56 +0000 UTC" itemprop=datePublished>2019-08-19</time>
<time style=display:none id=post-update-time>2019-08-19</time></a></div><div class=article-category><a class=article-category-link href=../../../categories/docker data-aos=zoom-in>DOCKER</a></div></div><div class=hr-line></div><div class="e-content article-entry" itemprop=articleBody><h2 id=compose简介><a class=header-anchor href=#compose%e7%ae%80%e4%bb%8b></a>Compose简介</h2><p>Compose项目是Docker官方的开源项目，负责实现对Docker容器集群的快速编排。其代码目前在https://github.com/docker/compose 上开源。</p><p>Compose定位是定义和运行多个Docker容器的应用，其前身是开源项目Fig。</p><p>通过前面内容的介绍，我们知道使用一个Dockerfile模板文件，可以让用户很方便的定义一个单独的应用容器。然而，在日常工作中，经常会碰到需要多个容器相互配合来完成某任务的情况。例如要实现一个Web项目,除了Web服务容器本身，往往还需要加上后端的数据库服务容器，甚至还包括负载均衡容器等。</p><p>Compose恰好满足了这样的需求。它允许用户通过一个单独的docker-compose.yml模板文件来定义一组相关联的应用容器为一个项目(project)。</p><p>Compose中有两个重要的概念：</p><ul><li>服务(service):一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。</li><li>项目(project):由一组关联的应用容器组成的一个完整业务单元。</li></ul><p>Compose的默认管理对象是项目，通过子命令对项目中的一组容器进行便捷地生命周期管理。</p><p>Compose项目由Python编写，实现上调用了Docker服务提供的API来对容器进行管理。</p><h2 id=安装和卸载><a class=header-anchor href=#%e5%ae%89%e8%a3%85%e5%92%8c%e5%8d%b8%e8%bd%bd></a>安装和卸载</h2><p>Compose支持Linux、macOS、Windows10三大平台。</p><p>Compose可以通过Python的包管理工具pip进行安装，也可以直接下载编译好的二进制文件使用，甚至能够直接在Docker容器中运行。</p><p>Docker for Mac、Docker for Windows自带docker-compose二进制文件，安装Docker之后可以直接使用。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose --version
</span></span></code></pre></div><p>Linux系统需要单独使用二进制或者pip方式进行安装。</p><h3 id=linux安装docker-compose><a class=header-anchor href=#linux%e5%ae%89%e8%a3%85docker-compose></a>Linux安装docker-compose</h3><h4 id=二进制包><a class=header-anchor href=#%e4%ba%8c%e8%bf%9b%e5%88%b6%e5%8c%85></a>二进制包</h4><p>在Linux上的安装十分简单，从官方GitHub Release处直接下载编译好的二进制文件即可。例如，在Linux64位系统上直接下载对应的二进制包。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo curl -L <span class=s2>&#34;https://github.com/docker/compose/releases/download/1.24.1/docker-compose-</span><span class=k>$(</span>uname -s<span class=k>)</span><span class=s2>-</span><span class=k>$(</span>uname -m<span class=k>)</span><span class=s2>&#34;</span> -o /usr/local/bin/docker-compose
</span></span><span class=line><span class=cl>sudo chmod +x /usr/local/bin/docker-compose  <span class=c1>#赋予可执行权限</span>
</span></span></code></pre></div><p><img src=https://ueyao.github.io/image-hosting/blog/2019/8/docker-compose-01.png></p><h4 id=pip安装><a class=header-anchor href=#pip%e5%ae%89%e8%a3%85></a>PIP安装</h4><p>如果您计算机的架构是ARM(例如，树莓派),建议使用pip安装。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo pip install -U docker-compose
</span></span></code></pre></div><h2 id=使用><a class=header-anchor href=#%e4%bd%bf%e7%94%a8></a>使用</h2><p>场景：最常见的项目是web网站，一般的web网站都会依赖第三方提供的服务(比如：DB和cache),我们拿dubbo-admin进行讲解(dubbo-admin依赖zookeeper)。</p><h3 id=compose构建dubbo-admin服务><a class=header-anchor href=#compose%e6%9e%84%e5%bb%badubbo-admin%e6%9c%8d%e5%8a%a1></a>Compose构建dubbo-admin服务</h3><p>从github上获取dubbo-admin的master分支源码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone -b master https://github.com/apache/incubator-dubbo-ops.git
</span></span></code></pre></div><p>修改admin中的application配置，把zookeeper地址改为zookeeper://zookeeper:2181</p><p><img src=https://ueyao.github.io/image-hosting/blog/2019/8/docker-compose-02.png></p><p>使用maven进行编译打包</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mvn clean package -Dmaven.test.skip<span class=o>=</span><span class=nb>true</span>
</span></span></code></pre></div><p><img src=https://ueyao.github.io/image-hosting/blog/2019/8/docker-compose-03.png></p><p>在dubbo-admin目录下编写Dockerfile文件，内容为</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># FROM,表示使用JDK8环境为基础镜像，如果镜像不是本地会从DockerHub进行下载</span>
</span></span><span class=line><span class=cl>FROM openjdk:8-jdk-alpine
</span></span><span class=line><span class=cl><span class=c1># 作者</span>
</span></span><span class=line><span class=cl>MAINTAINER Simon&lt;xueyao.me@gmail.com&gt;
</span></span><span class=line><span class=cl>VOLUME /tmp
</span></span><span class=line><span class=cl><span class=c1># ADD,拷贝文件并且重命名</span>
</span></span><span class=line><span class=cl>ADD ./target/dubbo-admin-0.0.1-SNAPSHOT.jar app.jar
</span></span><span class=line><span class=cl><span class=c1># ENTRYPOINT,为了缩短Tomcat启动时间，添加java.security.egd的系统属性指向/dev/urandom作为ENTRYPOINT</span>
</span></span><span class=line><span class=cl>ENTRYPOINT <span class=o>[</span><span class=s2>&#34;java&#34;</span>, <span class=s2>&#34;-Djava.security.egd=file:/dev/./urandom&#34;</span>,<span class=s2>&#34;-jar&#34;</span>,<span class=s2>&#34;/app.jar&#34;</span><span class=o>]</span>
</span></span></code></pre></div><p>使用docker build -t dubbo-admin:1.0 .命令进行构建。
<img src=https://ueyao.github.io/image-hosting/blog/2019/8/docker-compose-04.png></p><p>在项目根目录下编写docker-compose.yml文件，这个是Compose使用的主模板文件。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.4&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zk_server</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper:3.4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>2181</span><span class=p>:</span><span class=m>2181</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dubbo-admin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>dubbo-admin:1.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>links</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>zk_server:zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>zk_server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>7001</span><span class=p>:</span><span class=m>7001</span><span class=w> 
</span></span></span></code></pre></div><p>在docker-compose.yml文件所在目录执行：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose up
</span></span></code></pre></div><p><img src=https://ueyao.github.io/image-hosting/blog/2019/8/docker-compose-05.png></p><p>在浏览器中访问http://服务器ip:7001 进行验证，用户名密码为:root/root guest/guest</p><p><img src=https://ueyao.github.io/image-hosting/blog/2019/8/docker-compose-06.png></p><h2 id=compose命令说明><a class=header-anchor href=#compose%e5%91%bd%e4%bb%a4%e8%af%b4%e6%98%8e></a>Compose命令说明</h2><h3 id=命令对象与格式><a class=header-anchor href=#%e5%91%bd%e4%bb%a4%e5%af%b9%e8%b1%a1%e4%b8%8e%e6%a0%bc%e5%bc%8f></a>命令对象与格式</h3><p>执行docker-compose [COMMAND] &ndash;help或者docker-compose help [COMMAND]可以查看具体某个命令的使用格式。</p><p>docker-compose命令的基本的使用格式是：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose <span class=o>[</span>-f<span class=o>=</span>&lt;arg&gt;...<span class=o>]</span> <span class=o>[</span>options<span class=o>]</span> <span class=o>[</span>COMMAND<span class=o>]</span> <span class=o>[</span>ARGS...<span class=o>]</span>
</span></span></code></pre></div><p>命令选项</p><ul><li>-f,&ndash;file FILE指定模板文件，默认为docker-compose.yml,可以多次指定。</li><li>-p,&ndash;project-name NAME指定项目名称，默认将使用所在目录名称作为项目名。</li><li>&ndash;x-networking使用Docker的可拔插网络后端特性</li><li>&ndash;x-network-driver DRIVER指定网络后端的驱动,默认为bridge</li><li>&ndash;verbose输出更多调试信息。</li><li>-v,&ndash;version打印版本并退出。</li></ul><p>build</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>格式为docker-compose build [options] [SERVICE...]。
</span></span><span class=line><span class=cl>构建(重新构建)项目中的服务容器。
</span></span><span class=line><span class=cl>可以随时在项目目录下运行docker-compose build来重新构建服务。
</span></span><span class=line><span class=cl>选项包括：
</span></span><span class=line><span class=cl>* --force-rm 删除构建过程中的临时容器。
</span></span><span class=line><span class=cl>* --no-cache 构建镜像过程中不使用cache(将加长构建过程)。
</span></span><span class=line><span class=cl>* --pull 始终尝试通过pull来获取更新版本的镜像。
</span></span></code></pre></div><p>logs</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>格式为docker-compose logs [options] [SERVICE...]。
</span></span><span class=line><span class=cl>查看服务容器的输出。默认情况下,docker-compose将对不同的服务输出使用不同的颜色来区分。可以通过--no-color来关闭颜色。
</span></span></code></pre></div><p>port</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>格式为docker-compose port [options] SERVICE PRIVATE_PORT。
</span></span><span class=line><span class=cl>打印某个容器端口所映射的公共端口。
</span></span><span class=line><span class=cl>选项：
</span></span><span class=line><span class=cl> --protocol=proto指定端口协议，tcp(默认值)或者udp。
</span></span><span class=line><span class=cl> --index=index如果同一服务存在多个容器，指定命令对象容器的序号(默认为1)。
</span></span></code></pre></div><p>ps</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>格式为docker-compose ps [options] [SERVICE...]
</span></span><span class=line><span class=cl>列出项目中目前的所有容器。
</span></span><span class=line><span class=cl>选项：
</span></span><span class=line><span class=cl> -q只打印容器的ID信息。
</span></span></code></pre></div><p>pull</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>格式为docker-compose pull [options] [SERVICE...]。
</span></span><span class=line><span class=cl>拉取服务依赖的镜像。
</span></span><span class=line><span class=cl>选项：
</span></span><span class=line><span class=cl> --ignore-pull-failures忽略拉取镜像过程中的错误。
</span></span></code></pre></div><p>restart</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>格式为docker-compose restart [options] [SERVICE...]
</span></span><span class=line><span class=cl>重启项目中的服务。
</span></span><span class=line><span class=cl>选项：
</span></span><span class=line><span class=cl> -t,--timeout TIMEOUT指定重启前停止容器的超时(默认为10秒)。
</span></span></code></pre></div><p>rm</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>格式为docker-compose rm [options] [SERVICE...]
</span></span><span class=line><span class=cl>删除所有(停止状态的)服务容器。推荐先执行docker-compose stop命令来停止容器。
</span></span><span class=line><span class=cl>选项：
</span></span><span class=line><span class=cl> -f,--force强制直接删除，包括非停止状态的容器。一般尽量不要使用该选项。
</span></span><span class=line><span class=cl> -v删除容器所挂载的数据卷。
</span></span></code></pre></div><p>run</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>格式为docker-compose run[options] [-p PORT...][-e KEY=VAL...] SERVICE [COMMAND] [ARGS...]
</span></span><span class=line><span class=cl>在指定服务上执行一个命令。例如：
</span></span><span class=line><span class=cl>docker-compose run ubuntu ping docker.com
</span></span></code></pre></div><p>scale</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>格式为docker-compose scal [options] [SERVICE=NUM...]
</span></span><span class=line><span class=cl>设置指定服务运行的容器个数。例如：
</span></span><span class=line><span class=cl>docker-compose scale web=3 db=2
</span></span><span class=line><span class=cl>将启动3个容器运行web服务，2个容器运行db服务。
</span></span></code></pre></div><p>up</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>该命令十分强大，它将尝试自动完成包括构建镜像，(重新)创建服务,启动服务，并关联服务相关容器的一系列操作。链接的服务都将会被自动启动，除非已经处于运行状态。
</span></span><span class=line><span class=cl>选项：
</span></span><span class=line><span class=cl> -d 在后台运行服务容器。
</span></span><span class=line><span class=cl> --no-color 不使用颜色来区分不同的服务的控制台输出。
</span></span><span class=line><span class=cl> --no-deps 不启动服务所链接的容器。
</span></span><span class=line><span class=cl> --force-recreate强制重新创建容器，不能与--no-recreate同时使用。
</span></span><span class=line><span class=cl> --no-recreate如果容器已经存在了，则不重新创建，不能与--force-recreate同时使用。
</span></span><span class=line><span class=cl> --no-build 不自动构建缺失的服务镜像。
</span></span><span class=line><span class=cl> -t,--timeout TIMEOUT停止容器时候的超时(默认为10秒)。
</span></span></code></pre></div><p>其它命令如下：</p><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>version</td><td>格式为docker-compose version,打印版本信息</td></tr><tr><td>config</td><td>验证Compose格式是否正确，若正确则显示配置，若格式错误显示错误原因。</td></tr><tr><td>exec</td><td>进入指定的容器</td></tr><tr><td>images</td><td>列出Compose文件中包含的镜像</td></tr><tr><td>down</td><td>停止up命令所启动的容器，并移除网络。</td></tr><tr><td>help</td><td>获得一个命令的帮助</td></tr><tr><td>kill</td><td>通过发送SIGKILL信号来强制停止服务容器</td></tr><tr><td>pause</td><td>格式为docker-compose pause [SERVICE&mldr;],暂停一个服务容器。</td></tr><tr><td>push</td><td>推送服务依赖的镜像到Docker镜像仓库</td></tr><tr><td>start</td><td>格式为docker-compose start[SERVICE&mldr;],启动已经存在的服务容器。</td></tr><tr><td>stop</td><td>停止已经存在的服务容器。</td></tr><tr><td>top</td><td>查看各个服务容器内运行的进程</td></tr><tr><td>unpause</td><td>格式为docker-compose unpause [SERVICE&mldr;],恢复处于暂停状态中的服务。</td></tr></tbody></table><h2 id=compose模板文件><a class=header-anchor href=#compose%e6%a8%a1%e6%9d%bf%e6%96%87%e4%bb%b6></a>Compose模板文件</h2><p>模板文件是使用Compose的核心，涉及到的指令关键字也比较多，大部分指令跟docker run 相关参数的含义都类似。</p><p>默认的模板文件名称为docker-compose.yml,格式为YAML格式。</p><p>注意每个服务都必须通过image指令指定镜像或build指令(需要Dockerfile)等来自动构建生成镜像。</p><p>如果使用build指令,在Dockerfile中设置的选项(例如:CMD,EXPOSE,VOLUME,ENV等)将会自动被获取，无需在docker-compose.yml中再次设置。下面介绍常用指令的用法。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>webapp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>./dir</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class=l>Dockerfile-alternate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>args</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>buildno</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span></code></pre></div><p>build</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>指令Dockerfile所在文件夹的路径<span class=o>(</span>可以是绝对路径,或者相对docker-compose.yml文件的路径<span class=o>)</span>。
</span></span><span class=line><span class=cl>Compose将会利用它自动构建这个镜像,然后使用这个镜像。
</span></span><span class=line><span class=cl>使用context指令指定Dockerfile所在文件夹的路径
</span></span><span class=line><span class=cl>使用dockerfile指令指定Dockerfile文件名
</span></span><span class=line><span class=cl>使用arg指令指定构建镜像时的变量
</span></span></code></pre></div><p>command</p><p>覆盖容器启动后默认执行的命令。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>command:echo <span class=s2>&#34;hello world&#34;</span>
</span></span></code></pre></div><p>Container_name</p><p>指令容器名称。默认将会使用项目名称_服务名称_序号这样的格式。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>container_name:docker-web-container
</span></span></code></pre></div><p>configs</p><p>仅用于Swarm mode, 详细内容后页面swarm mode会进到。</p><p>deploy</p><p>仅用于Swarm mode,详细内容后面swarm mode会进到。</p><p>devices</p><p>指定设备映射关系。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>devices:
</span></span><span class=line><span class=cl>    - <span class=s2>&#34;/dev/ttyUSB1:/ttyUSB0&#34;</span>
</span></span></code></pre></div><p>depends_on</p><p>解决容器的依赖、启动先后的问题。</p><p>dns</p><p>自定义DNS服务器。可以是一个值，也可以是一个列表。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dns: 8.8.8.8
</span></span><span class=line><span class=cl>dns:
</span></span><span class=line><span class=cl>  - 8.8.8.8
</span></span><span class=line><span class=cl>  - 114.114.114.114
</span></span></code></pre></div><p>environment</p><p>设置环境变量。你可以使用数组或字典两种格式。
只给定名称的变量会自动获取运行Compose主机上对应变量的值，可以用来防止泄露不必要的数据。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>environment:
</span></span><span class=line><span class=cl>  RACK_ENV: development
</span></span><span class=line><span class=cl>  SESSION_SECRET:
</span></span><span class=line><span class=cl>environment:
</span></span><span class=line><span class=cl>  - <span class=nv>RACK_ENV</span><span class=o>=</span>development
</span></span><span class=line><span class=cl>  - SESSION_SECRET  
</span></span></code></pre></div><p>expose</p><p>显露端口，但不映射到宿主机，只被连接的服务访问。仅可以指定内部端口为参数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>expose:
</span></span><span class=line><span class=cl>  - <span class=s2>&#34;3000&#34;</span>
</span></span><span class=line><span class=cl>  - <span class=s2>&#34;8000&#34;</span>
</span></span></code></pre></div><p>extra_hosts</p><p>类似Docker中的&ndash;add-host参数，指定额外的host名称映射信息。
会在启动后的服务容器中/etc/hosts文件中添加一条条目。8.8.8.8 googledns</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>extra_hosts:
</span></span><span class=line><span class=cl>  - <span class=s2>&#34;googledns:8.8.8.8&#34;</span>
</span></span></code></pre></div><p>healthcheck</p><p>通过命令容器是否健康运行。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>healthcheck:
</span></span><span class=line><span class=cl>   test:<span class=o>[</span><span class=s2>&#34;CMD&#34;</span>,<span class=s2>&#34;curl&#34;</span>,<span class=s2>&#34;-f&#34;</span>,<span class=s2>&#34;http://localhost&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>   interval:1m30s
</span></span><span class=line><span class=cl>   timeout:10s
</span></span><span class=line><span class=cl>   retries:3
</span></span></code></pre></div><p>image</p><p>指定为镜像名称或镜像ID。如果镜像在本地不存在，Compose将会尝试拉去这个镜像</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>image:session-web:latest
</span></span></code></pre></div><p>lables</p><p>为容器添加Docker元数据(metadata)信息。例如可以为容器添加辅助说明信息。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>labels:
</span></span><span class=line><span class=cl>  com.study.department:<span class=s2>&#34;devops department&#34;</span>
</span></span><span class=line><span class=cl>  com.study.release:<span class=s2>&#34;v1.0&#34;</span>
</span></span></code></pre></div><p>links</p><p>连接到其他容器。注意：不推荐使用该指令。
应该使用docker network,建立网络,而docker run &ndash;network来连接特定网络。或者使用version:&lsquo;2&rsquo;和更高版本的docker-compose.yml直接定义自定义网络并使用。</p><p>network_mode</p><p>设置网络模式。使用和docker run的&ndash;network参数一样的值。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>network_mode:<span class=s2>&#34;bridge&#34;</span>
</span></span><span class=line><span class=cl>network_mode:<span class=s2>&#34;host&#34;</span>
</span></span><span class=line><span class=cl>network_mode:<span class=s2>&#34;none&#34;</span>
</span></span></code></pre></div><p>networks</p><p>配置容器连接的网络。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>version:<span class=s2>&#34;3&#34;</span>
</span></span><span class=line><span class=cl>services:
</span></span><span class=line><span class=cl>  some-service:
</span></span><span class=line><span class=cl>    networks:
</span></span><span class=line><span class=cl>      - some-network
</span></span><span class=line><span class=cl>networks:
</span></span><span class=line><span class=cl>  some-network:      
</span></span></code></pre></div><p>ports</p><p>暴露端口信息。使用宿主端口：容器端口(HOST:CONTAINER)格式，或者仅仅指定容器的端口(宿主将会随机选择端口)都可以。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ports:
</span></span><span class=line><span class=cl>  - <span class=s2>&#34;3000&#34;</span>
</span></span><span class=line><span class=cl>  - <span class=s2>&#34;8000:8000&#34;</span>
</span></span></code></pre></div><p>volumes</p><p>数据卷所挂载路径设置，可以设置宿主机路径，同时支持相关路径。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>volumes:
</span></span><span class=line><span class=cl>  - /var/lib/mysql
</span></span><span class=line><span class=cl>  - cache/:/tmp/cache
</span></span><span class=line><span class=cl>  - ~/configs:/etc/configs/:ro
</span></span></code></pre></div><p>ulimits</p><p>指定容器的ulimits限制值。
例如，指定最大进程数为65535,指定文件句柄数为20000(软限制,应用可以随时修改,不能超过硬限制)和40000(系统硬限制，只能root用户提高)。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ulimits:
</span></span><span class=line><span class=cl>  nproc: <span class=m>65535</span>
</span></span><span class=line><span class=cl>  nofile:
</span></span><span class=line><span class=cl>    soft: <span class=m>20000</span>
</span></span><span class=line><span class=cl>    hard: <span class=m>40000</span>
</span></span></code></pre></div><p>此外，还有包括domainname,entrypoint,hostname,ipc,mac_address,privileged,read_only,shm_size,restart,stdin_open,tty,user,working_dir等指令，基本跟docker run中对应参数的功能相同。</p><p>指定服务容器启动后执行的入口文件</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>entrypoint: /code/entrypoint.sh
</span></span></code></pre></div><p>指定容器中运行应用的用户名</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>user:nginx
</span></span></code></pre></div><p>指定容器中工作目录</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>working_dir: /code
</span></span></code></pre></div><p>指定容器中搜索域名、主机名、mac地址等</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>domainname:your_website.com
</span></span><span class=line><span class=cl>hostname:test
</span></span><span class=line><span class=cl>mac_address:08-00-27-00-0C-0A
</span></span></code></pre></div><p>允许容器中运行一些特权命令</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>privileged:true
</span></span></code></pre></div><p>指定容器退出后的重启策略为始终重启。在生产环境中推荐配置为always或者unless-stopped</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>restart:alwarys
</span></span></code></pre></div><p>以只读模式挂载容器的root文件系统，意味着不能对容器内容进行修改</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>read_only:true
</span></span></code></pre></div><p>打开标准输入，可以接受外部输入</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>stdin_open:true
</span></span></code></pre></div><p>模拟一个伪终端</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>tty:true
</span></span></code></pre></div><p>Compose模板文件支持动态读取主机的系统环境变量和当前目录下的.env文件中的变量。例如，下面的Compose文件将从运行它的环境中读取变量${MONGO_VERSION}的值，并写入执行的指令中。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>version: <span class=s2>&#34;3&#34;</span>
</span></span><span class=line><span class=cl>services:
</span></span><span class=line><span class=cl>  db:
</span></span><span class=line><span class=cl>    image: <span class=s2>&#34;mongo:</span><span class=si>${</span><span class=nv>MONGO_VERSION</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span></code></pre></div><p>如果执行MONGO_VERSION=3.2 docker-compose up则会启动一个mongo:3.2镜像的容器。若当前目录存在.env文件，执行docker-compose命令时将从该文件中读取变量。</p></div><footer class=article-footer><blockquote class=article-copyright><p><strong><span class="icon-user icon"></span>本文作者：</strong>薛尧笔记 @ 薛尧笔记</p><p><strong><span class="icon-link icon"></span>本文链接：</strong><a href=https://xueyao.netlify.app/post/2019/docker-guide-compose-use/>https://xueyao.netlify.app/post/2019/docker-guide-compose-use/</a></p><p><strong><span class="icon-copyright icon"></span>本文版权：</strong>本博客所有文章除特别声明外，均采用
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh rel="noopener external nofollow noreferrer" target=_blank><span class=icon-creative-commons></span>BY-NC-SA</a>
许可协议。转载请注明出处！</p><span class="icon-creative-commons article-copyright-bg"></span></blockquote><div class=sponsor-wrapper><div class=sponsor-button-wrapper><div class="sponsor-icon rotate"></div><div class=sponsor-title>赞助</div></div><div class=sponsor-tip>请作者喝杯咖啡吧！</div><div class=sponsor-qr><div class=sponsor-qr-image-wrapper><img src=../../../sponsor/alipay.jpg alt=支付宝 width=200><p class=sponsor-qr-name>支付宝</p></div><div class=sponsor-qr-image-wrapper><img src=../../../sponsor/wechat.jpg alt=微信 width=200><p class=sponsor-qr-name>微信</p></div></div></div><div class=share-wrapper><a href="http://service.weibo.com/share/share.php?url=https://xueyao.netlify.app/post/2019/docker-guide-compose-use/&amp;appkey=&amp;title=Docker%e5%85%a5%e9%97%a8-docker%20compose%e7%9a%84%e4%bd%bf%e7%94%a8&amp;pic=&amp;ralateUid=" target=_blank rel="noopener noreferrer" title="Docker入门-docker compose的使用"><div class="share-icon icon icon-weibo"></div></a><a href="http://connect.qq.com/widget/shareqq/index.html?url=https://xueyao.netlify.app/post/2019/docker-guide-compose-use/&amp;title=Docker%e5%85%a5%e9%97%a8-docker%20compose%e7%9a%84%e4%bd%bf%e7%94%a8&amp;desc=Compose%e7%ae%80%e4%bb%8b%20Compose%e9%a1%b9%e7%9b%ae%e6%98%afDocker%e5%ae%98%e6%96%b9%e7%9a%84%e5%bc%80%e6%ba%90%e9%a1%b9%e7%9b%ae%ef%bc%8c%e8%b4%9f%e8%b4%a3%e5%ae%9e%e7%8e%b0%e5%af%b9Docker%e5%ae%b9%e5%99%a8%e9%9b%86%e7%be%a4%e7%9a%84%e5%bf%ab%e9%80%9f%e7%bc%96%e6%8e%92%e3%80%82%e5%85%b6%e4%bb%a3%e7%a0%81%e7%9b%ae%e5%89%8d%e5%9c%a8https://github.com/docker/compose%20%e4%b8%8a%e5%bc%80%e6%ba%90%e3%80%82%0aCompose%e5%ae%9a%e4%bd%8d%e6%98%af%e5%ae%9a%e4%b9%89%e5%92%8c%e8%bf%90%e8%a1%8c%e5%a4%9a%e4%b8%aaDocker%e5%ae%b9%e5%99%a8%e7%9a%84%e5%ba%94%e7%94%a8%ef%bc%8c%e5%85%b6%e5%89%8d%e8%ba%ab%e6%98%af%e5%bc%80%e6%ba%90%e9%a1%b9%e7%9b%aeFig%e3%80%82%0a%e9%80%9a%e8%bf%87%e5%89%8d%e9%9d%a2%e5%86%85%e5%ae%b9%e7%9a%84%e4%bb%8b%e7%bb%8d%ef%bc%8c%e6%88%91%e4%bb%ac%e7%9f%a5%e9%81%93%e4%bd%bf%e7%94%a8%e4%b8%80%e4%b8%aaDockerfile%e6%a8%a1%e6%9d%bf%e6%96%87%e4%bb%b6%ef%bc%8c%e5%8f%af%e4%bb%a5%e8%ae%a9%e7%94%a8%e6%88%b7%e5%be%88%e6%96%b9%e4%be%bf%e7%9a%84%e5%ae%9a%e4%b9%89%e4%b8%80%e4%b8%aa%e5%8d%95%e7%8b%ac%e7%9a%84%e5%ba%94%e7%94%a8%e5%ae%b9%e5%99%a8%e3%80%82%e7%84%b6%e8%80%8c%ef%bc%8c%e5%9c%a8%e6%97%a5%e5%b8%b8%e5%b7%a5%e4%bd%9c%e4%b8%ad%ef%bc%8c%e7%bb%8f%e5%b8%b8%e4%bc%9a%e7%a2%b0%e5%88%b0%e9%9c%80%e8%a6%81%e5%a4%9a%e4%b8%aa%e5%ae%b9%e5%99%a8%e7%9b%b8%e4%ba%92%e9%85%8d%e5%90%88%e6%9d%a5%e5%ae%8c%e6%88%90%e6%9f%90%e4%bb%bb%e5%8a%a1%e7%9a%84%e6%83%85%e5%86%b5%e3%80%82%e4%be%8b%e5%a6%82%e8%a6%81%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aaWeb%e9%a1%b9%e7%9b%ae,%e9%99%a4%e4%ba%86Web%e6%9c%8d%e5%8a%a1%e5%ae%b9%e5%99%a8%e6%9c%ac%e8%ba%ab%ef%bc%8c%e5%be%80%e5%be%80%e8%bf%98%e9%9c%80%e8%a6%81%e5%8a%a0%e4%b8%8a%e5%90%8e%e7%ab%af%e7%9a%84%e6%95%b0%e6%8d%ae%e5%ba%93%e6%9c%8d%e5%8a%a1%e5%ae%b9%e5%99%a8%ef%bc%8c%e7%94%9a%e8%87%b3%e8%bf%98%e5%8c%85%e6%8b%ac%e8%b4%9f%e8%bd%bd%e5%9d%87%e8%a1%a1%e5%ae%b9%e5%99%a8%e7%ad%89%e3%80%82%0aCompose%e6%81%b0%e5%a5%bd%e6%bb%a1%e8%b6%b3%e4%ba%86%20%e2%80%a6&amp;source=https://xueyao.netlify.app/" target=_blank rel="noopener noreferrer" title="Docker入门-docker compose的使用"><div class="share-icon icon icon-qq"></div></a><a href=javascript:; title="Docker入门-docker compose的使用"><div class="share-icon icon icon-weixin"><div id=share-weixin><div class=share-weixin-dom><div class=share-weixin-content><img id=share-weixin-banner><div id=share-weixin-title></div><div id=share-weixin-desc></div></div><div class=share-weixin-qrcode><div class=share-weixin-info><div id=share-weixin-author></div><div id=share-weixin-theme>Powered By hugo-theme-reimu</div></div><img id=share-weixin-qr></div></div><div class=share-weixin-canvas></div></div></div></a></div><a data-aos=zoom-in href=https://xueyao.netlify.app/post/2019/docker-guide-compose-use/#comments class=article-comment-link><span class="post-comments-count waline-comment-count" data-path=https//xueyao.netlify.app/post/2019/docker-guide-compose-use/ itemprop=commentCount></span>
留言
</a><span data-aos=zoom-in class=article-visitor-link><span class=waline-pageview-count data-path=/post/2019/docker-guide-compose-use/>0</span>
<em class=post-meta-item-text>阅读量</em></span><ul class=article-tag-list itemprop=keywords></ul></footer></div><nav id=article-nav data-aos=fade-up><div class="article-nav-link-wrap article-nav-link-left"><img data-src=https://cdn.jsdelivr.net/gh/ueYao/image-hosting@main/blog/2025/02/20250218031353094828.jpg data-sizes=auto alt=Docker入门-数据挂载 class=lazyload>
<a href=https://xueyao.netlify.app/post/2019/docker-guide-data-mount/></a><div class=article-nav-caption>前一篇</div><h3 class=article-nav-title>Docker入门-数据挂载</h3></div><div class="article-nav-link-wrap article-nav-link-right"><img data-src=https://cdn.jsdelivr.net/gh/ueYao/image-hosting@main/blog/2025/02/20250218031307613131.jpg data-sizes=auto alt=Docker进阶-快速扩容 class=lazyload>
<a href=https://xueyao.netlify.app/post/2019/docker-guide-expansion/></a><div class=article-nav-caption>后一篇</div><h3 class=article-nav-title>Docker进阶-快速扩容</h3></div></nav></article><div id=comments class=wcomment data-aos=fade-up></div></section></div><div id=aplayer theme=var(--color-link) data-aos=fade-up></div><footer id=footer><div style=width:100%;overflow:hidden><div class=footer-line></div></div><div id=footer-info><div><span class=icon-copyright></span>
2020 -
2025
<span class="footer-info-sep rotate"></span>
薛尧笔记</div><div>基于&nbsp;<a href=https://gohugo.io/ target=_blank>Hugo</a>&nbsp; Theme.<a href=https://github.com/D-Sketon/hugo-theme-reimu target=_blank>Reimu</a></div><div><span class=icon-brush>&nbsp;
19.0k
</span>&nbsp;|&nbsp;
<span class=icon-coffee>&nbsp;
02:20</span></div><div><span class=icon-eye></span>
<span id=busuanzi_container_site_pv>总访问量&nbsp;<span id=busuanzi_value_site_pv></span></span>
&nbsp;|&nbsp;
<span class=icon-user></span>
<span id=busuanzi_container_site_uv>总访客量&nbsp;<span id=busuanzi_value_site_uv></span></span></div></div></footer><div class=sidebar-top><div class="sidebar-top-taichi rotate"></div><div class=arrow-up></div></div><div id=mask class=hide></div></div><nav id=mobile-nav><div class=sidebar-wrap><div class=sidebar-toc-sidebar><div class=sidebar-toc><h3 class=toc-title>文章目录</h3><div class="sidebar-toc-wrapper toc-div-class"><nav id=TableOfContents><ul><li><a href=#compose简介>Compose简介</a></li><li><a href=#安装和卸载>安装和卸载</a><ul><li><a href=#linux安装docker-compose>Linux安装docker-compose</a></li></ul></li><li><a href=#使用>使用</a><ul><li><a href=#compose构建dubbo-admin服务>Compose构建dubbo-admin服务</a></li></ul></li><li><a href=#compose命令说明>Compose命令说明</a><ul><li><a href=#命令对象与格式>命令对象与格式</a></li></ul></li><li><a href=#compose模板文件>Compose模板文件</a></li></ul></nav></div></div></div><div class="sidebar-common-sidebar hidden"><div class=sidebar-author><img data-src=../../../avatar/avatar.png data-sizes=auto alt=薛尧笔记 class=lazyload><div class=sidebar-author-name>薛尧笔记</div><div class=sidebar-description>平凡的程序员</div></div><div class=sidebar-state><div class=sidebar-state-article><div>文章</div><div class=sidebar-state-number>83</div></div><div class=sidebar-state-category><div>分类</div><div class=sidebar-state-number>17</div></div><div class=sidebar-state-tag><div>标签</div><div class=sidebar-state-number>12</div></div></div><div class=sidebar-social><div class="icon-github sidebar-social-icon"><a href=https://github.com/flowstone itemprop=url target=_blank aria-label=github rel="noopener external nofollow noreferrer"></a></div></div><div class=sidebar-menu><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=../../../ aria-label=首页></a><div class='sidebar-menu-icon icon'>&#xf015;</div><div class=sidebar-menu-link>首页</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=../../../archives aria-label=归档></a><div class='sidebar-menu-icon icon'>&#xf187;</div><div class=sidebar-menu-link>归档</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=../../../about aria-label=关于></a><div class='sidebar-menu-icon icon'>&#xf129;</div><div class=sidebar-menu-link>关于</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=../../../friend aria-label=友链></a><div class='sidebar-menu-icon icon'>&#xf004;</div><div class=sidebar-menu-link>友链</div></div></div></div></div><div class=sidebar-btn-wrapper><div class="sidebar-toc-btn current"></div><div class=sidebar-common-btn></div></div></nav></div><script src=https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js integrity=sha384-3gT/vsepWkfz/ff7PpWNUeMzeWoH3cDhm/A8jM7ouoAK0/fP/9bcHHR5kHq2nf+e crossorigin=anonymous></script><script src=https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js integrity=sha384-J08i8An/QeARD9ExYpvphB8BsyOj3Gh2TSh1aLINKO3L0cMSH2dN3E22zFoXEi0Q crossorigin=anonymous></script><script src=../../../js/main.js integrity crossorigin=anonymous></script><script src=../../../js/aos.js integrity crossorigin=anonymous></script><script>var aosInit=()=>{AOS.init({duration:1e3,easing:"ease",once:!0,offset:50})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",aosInit):aosInit()</script><script src=../../../js/pjax_main.js integrity crossorigin=anonymous data-pjax></script><script src=https://npm.webcache.cn/mouse-firework@0.1.0/dist/index.umd.js integrity=sha384-KM6i7tu43nYd6e0beIljxHMC5tZc58XBDu7pPA58w50h18Jsx7gLdimfS09RXlKv crossorigin=anonymous></script><script>if(window.firework){const e=JSON.parse('{"excludeelements":["a","button"],"particles":[{"colors":["#ff5252","#ff7c7c","#ffafaf","#ffd0d0"],"duration":[1200,1800],"easing":"easeOutExpo","move":["emit"],"number":20,"shape":"circle","shapeOptions":{"alpha":[0.3,0.5],"radius":[16,32]}},{"colors":["#ff0000"],"duration":[1200,1800],"easing":"easeOutExpo","move":["diffuse"],"number":1,"shape":"circle","shapeOptions":{"alpha":[0.2,0.5],"lineWidth":6,"radius":20}}]}');e.excludeElements=e.excludeelements,delete e.excludeelements,window.firework(e)}</script><div id=lazy-script><div><script data-pjax>window.REIMU_POST={author:"薛尧笔记",title:"Docker入门-docker compose的使用",url:"https://xueyao.netlify.app/post/2019/docker-guide-compose-use/",description:`Compose简介 Compose项目是Docker官方的开源项目，负责实现对Docker容器集群的快速编排。其代码目前在https://github.com/docker/compose 上开源。
Compose定位是定义和运行多个Docker容器的应用，其前身是开源项目Fig。
通过前面内容的介绍，我们知道使用一个Dockerfile模板文件，可以让用户很方便的定义一个单独的应用容器。然而，在日常工作中，经常会碰到需要多个容器相互配合来完成某任务的情况。例如要实现一个Web项目,除了Web服务容器本身，往往还需要加上后端的数据库服务容器，甚至还包括负载均衡容器等。
Compose恰好满足了 …`,cover:"https://xueyao.netlify.app/images/banner.webp"}</script><script src=../../../js/insert_highlight.js integrity crossorigin=anonymous data-pjax></script><script type=module data-pjax>
        const PhotoSwipeLightbox = (await safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe-lightbox.esm.min.js", "sha384-DiL6M\/gG\u002bwmTxmCRZyD1zee6lIhawn5TGvED0FOh7fXcN9B0aZ9dexSF\/N6lrZi\/")).default;

        const pswp = () => {
          if (_$$('.article-entry a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-entry',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")
            }).init();
          }
          if(_$$('.article-gallery a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-gallery',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")
            }).init();
          }
          window.lightboxStatus = 'done';
          window.removeEventListener('lightbox:ready', pswp);
        }
        if(window.lightboxStatus === 'ready') {
          pswp()
        } else {
          window.addEventListener('lightbox:ready', pswp);
        }
      </script><script data-pjax type=module>
  const { init } = await safeImport('https:\/\/npm.webcache.cn\/@waline\/client@2.15.8\/dist\/waline.mjs', 'sha384-9sbqJjrfGjbkI6\/PI4nU\/MvBfEmkkPC4YK9I4zBeMIf1CVCZdCMH\/KinBEAZII\/5');
  if(_$('.wcomment')) {
    window.walineInstance = init({
      el: '.wcomment',
      serverURL: 'blog-waline-ochre-five.vercel.app',
      lang: 'zh-CN',
      locale: JSON.parse("{}"),
      emoji: JSON.parse("[\"https://unpkg.com/@waline/emojis@1.2.0/weibo\",\"https://unpkg.com/@waline/emojis@1.2.0/alus\",\"https://unpkg.com/@waline/emojis@1.2.0/bilibili\",\"https://unpkg.com/@waline/emojis@1.2.0/qq\",\"https://unpkg.com/@waline/emojis@1.2.0/tieba\",\"https://unpkg.com/@waline/emojis@1.2.0/tw-emoji\"]"),
      meta: JSON.parse("[\"nick\",\"mail\",\"link\"]"),
      requiredMeta: JSON.parse("[\"nick\",\"mail\"]"),
      wordLimit:  0 ,
      comment: true,
      pageSize:  10 ,
      dark: 'html[data-theme="dark"]',
      pageview:  true ,
    });
  }
</script><script src=https://npm.webcache.cn/qrcode@1.4.4/build/qrcode.min.js defer data-pjax integrity=sha384-0RsG1yo/crf/1Qc14sho26SXXOTngNCjgJw7fuvXBt9W/OChF/Ijx+aUuBDqQwEk crossorigin=anonymous></script><script src=https://npm.webcache.cn/html-to-image@1.11.11/dist/html-to-image.js defer data-pjax integrity=sha384-UbfRVKN3/elS1r7JcK2FhmPP+KlJ4CvYwbyYD7tH+uTkbT9bNJr9eJeQ0FoFbAgz crossorigin=anonymous></script></div></div><script src=https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js async integrity=sha384-0M75wtSkhjIInv4coYlaJU83+OypaRCIq2SukQVQX04eGTCBXJDuWAbJet56id+S crossorigin=anonymous></script><script>"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(e=>{for(let t of e)t.unregister()})</script><script>const reimuCopyright=String.raw`
   ______     ______     __     __    __     __  __    
  /  ==    /  ___   /    / "-./     / /    
     __<      __         -./     _   
    _ _   _____   _   _  _   _____ 
    /_/ /_/   /_____/   /_/   /_/  /_/   /_____/ 
                                                    
  `;console.log(String.raw`%c ${reimuCopyright}`,"color: #ff5252;"),console.log("%c Theme.Reimu %c https://github.com/D-Sketon/hugo-theme-reimu ","color: white; background: #ff5252; padding:5px 0;","padding:4px;border:1px solid #ff5252;")</script><script src=https://npm.webcache.cn/aplayer@1.10.1/dist/APlayer.min.js integrity=sha384-gdGYZwHnfJM54evoZhpO0s6ZF5BQiybkiyW7VXr+h5UfruuRL/aORyw+5+HZoU6e crossorigin=anonymous></script><script>const ap=new APlayer({theme:"var(--color-link)",container:document.getElementById("aplayer"),audio:JSON.parse('[{"artist":"澤野弘之","cover":"https://cdn.jsdelivr.net/gh/ueYao/image-hosting@main/blog/2025/02/20250225043234450578.png","lrc":"https://cdn.jsdelivr.net/gh/ueYao/static_resource@main/Call%20of%20Silence.lrc","name":"Call of Silence","theme":"#FADFA3","url":"https://cdn.jsdelivr.net/gh/ueYao/static_resource@main/Call%20of%20Silence.mp3"}]')||[],fixed:!0||!1,autoplay:!0||!1,loop:"all"||"all",order:"list"||"list",preload:"auto"||"auto",volume:null||.7,mutex:null||!0,listFolded:null||!1,lrcType:3||0})</script></body></html>